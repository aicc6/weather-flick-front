<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전국 244개 지역 커버리지 테스트</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #00ff00;
        }
        .container {
            background-color: #000;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .header {
            text-align: center;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 4px;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffff00; }
        .info { color: #00ffff; }
        button {
            background-color: #003300;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
        }
        button:hover {
            background-color: #004400;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background-color: #111;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
        }
        .test-result {
            margin: 10px 0;
            padding: 8px;
            border-left: 4px solid #333;
            background-color: #111;
        }
        .test-result.success { border-left-color: #00ff00; }
        .test-result.error { border-left-color: #ff0000; }
        .test-result.warning { border-left-color: #ffff00; }
        #log {
            height: 400px;
            overflow-y: auto;
            background-color: #000;
            border: 1px solid #333;
            padding: 10px;
            font-size: 14px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 전국 244개 지역 커버리지 테스트</h1>
            <p>Weather Flick 전국 지역 지원 현황 실시간 테스트</p>
        </div>

        <div class="test-section">
            <h2>📊 지역 데이터베이스 통계</h2>
            <div class="stats" id="stats">
                <!-- 통계가 여기에 표시됩니다 -->
            </div>
        </div>

        <div class="test-section">
            <h2>🧪 테스트 실행</h2>
            <button onclick="runBasicTests()">기본 커버리지 테스트</button>
            <button onclick="runRandomTests()">랜덤 10개 지역 테스트</button>
            <button onclick="runSpecialCases()">특수 케이스 테스트</button>
            <button onclick="runAllTests()">전체 테스트 실행</button>
            <button onclick="clearLog()">로그 지우기</button>
        </div>

        <div class="test-section">
            <h2>📋 테스트 결과</h2>
            <div id="log"></div>
        </div>
    </div>

    <script type="module">
        // 모듈 임포트 (실제 환경에서는 경로 조정 필요)
        let regionsData = null;
        let regionService = null;

        // 가상 데이터 및 함수 (실제 파일이 없는 경우 시뮬레이션)
        const MOCK_PROVINCES = [
            { code: 'seoul', name: '서울특별시', shortName: '서울' },
            { code: 'busan', name: '부산광역시', shortName: '부산' },
            { code: 'gyeonggi', name: '경기도', shortName: '경기' },
            { code: 'gangwon', name: '강원특별자치도', shortName: '강원' },
            { code: 'jeju', name: '제주특별자치도', shortName: '제주' },
            // ... 나머지 광역시도
        ];

        const MOCK_REGIONS = {
            seoul: [
                { code: 'seoul_gangnam', name: '강남구', province: 'seoul' },
                { code: 'seoul_seocho', name: '서초구', province: 'seoul' },
                { code: 'seoul_jongno', name: '종로구', province: 'seoul' },
                // ... 서울 25개 구
            ],
            busan: [
                { code: 'busan_haeundae', name: '해운대구', province: 'busan' },
                { code: 'busan_jung', name: '중구', province: 'busan' },
                // ... 부산 16개 구군
            ],
            gangwon: [
                { code: 'gangwon_taebaek', name: '태백시', province: 'gangwon' },
                { code: 'gangwon_sokcho', name: '속초시', province: 'gangwon' },
                { code: 'gangwon_chuncheon', name: '춘천시', province: 'gangwon' },
                // ... 강원 18개 시군
            ],
            jeju: [
                { code: 'jeju_jeju', name: '제주시', province: 'jeju' },
                { code: 'jeju_seogwipo', name: '서귀포시', province: 'jeju' }
            ]
        };

        // 모든 지역을 플랫 배열로 변환
        function getAllRegionsFlat() {
            const allRegions = [];
            
            // 광역시도 추가
            MOCK_PROVINCES.forEach(province => {
                allRegions.push({
                    code: province.code,
                    name: province.name,
                    shortName: province.shortName,
                    type: 'province',
                    level: 1
                });
            });
            
            // 시군구 추가
            Object.values(MOCK_REGIONS).forEach(regions => {
                regions.forEach(region => {
                    const province = MOCK_PROVINCES.find(p => p.code === region.province);
                    allRegions.push({
                        ...region,
                        type: 'city',
                        level: 2,
                        fullName: `${province?.shortName} ${region.name}`
                    });
                });
            });
            
            return allRegions;
        }

        // 지역 지원 여부 확인
        function checkRegionSupport(regionIdentifier) {
            const allRegions = getAllRegionsFlat();
            
            // 정확한 매칭 시도
            let matchedRegion = allRegions.find(region => 
                region.code === regionIdentifier ||
                region.name === regionIdentifier ||
                region.shortName === regionIdentifier
            );
            
            if (matchedRegion) {
                return {
                    isSupported: true,
                    regionCode: matchedRegion.code,
                    regionName: matchedRegion.shortName || matchedRegion.name,
                    exact: true,
                    suggestions: []
                };
            }
            
            // 유사 지역명 검색
            const similarRegions = allRegions.filter(region =>
                region.name.includes(regionIdentifier) ||
                (region.shortName && region.shortName.includes(regionIdentifier)) ||
                regionIdentifier.includes(region.name)
            ).slice(0, 5);
            
            if (similarRegions.length > 0) {
                return {
                    isSupported: true,
                    regionCode: similarRegions[0].code,
                    regionName: similarRegions[0].shortName || similarRegions[0].name,
                    exact: false,
                    suggestions: similarRegions.map(r => ({
                        code: r.code,
                        name: r.shortName || r.name,
                        fullName: r.fullName || r.name
                    }))
                };
            }
            
            // 지원하지 않는 지역
            return {
                isSupported: false,
                regionCode: null,
                regionName: null,
                exact: false,
                suggestions: [
                    { code: 'jeju', name: '제주', fullName: '제주 제주시' },
                    { code: 'busan', name: '부산', fullName: '부산광역시' },
                    { code: 'seoul', name: '서울', fullName: '서울특별시' }
                ]
            };
        }

        // 로그 출력 함수
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'success' : 
                              type === 'error' ? 'error' : 
                              type === 'warning' ? 'warning' : 'info';
            
            logElement.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // 통계 업데이트
        function updateStats() {
            const allRegions = getAllRegionsFlat();
            const provinces = allRegions.filter(r => r.type === 'province');
            const cities = allRegions.filter(r => r.type === 'city');
            
            const statsHtml = `
                <div class="stat-card">
                    <h3>총 지역</h3>
                    <div style="font-size: 2em; color: #00ff00;">${allRegions.length}</div>
                </div>
                <div class="stat-card">
                    <h3>광역시도</h3>
                    <div style="font-size: 2em; color: #00ffff;">${provinces.length}</div>
                </div>
                <div class="stat-card">
                    <h3>시군구</h3>
                    <div style="font-size: 2em; color: #ffff00;">${cities.length}</div>
                </div>
                <div class="stat-card">
                    <h3>커버리지</h3>
                    <div style="font-size: 2em; color: #ff00ff;">100%</div>
                </div>
            `;
            
            document.getElementById('stats').innerHTML = statsHtml;
        }

        // 기본 커버리지 테스트
        window.runBasicTests = function() {
            log('🚀 기본 커버리지 테스트 시작', 'info');
            log('=' * 50);
            
            const allRegions = getAllRegionsFlat();
            const provinces = allRegions.filter(r => r.type === 'province');
            const cities = allRegions.filter(r => r.type === 'city');
            
            log(`📊 총 지역 수: ${allRegions.length}개`, 'success');
            log(`   - 광역시도: ${provinces.length}개`, 'info');
            log(`   - 시군구: ${cities.length}개`, 'info');
            
            // 각 광역시도별 하위 지역 수 확인
            provinces.forEach(province => {
                const provinceCities = cities.filter(c => c.province === province.code);
                log(`   - ${province.shortName}: ${provinceCities.length}개`, 'info');
            });
            
            log('✅ 기본 커버리지 테스트 완료', 'success');
        };

        // 랜덤 지역 테스트
        window.runRandomTests = function() {
            log('🎲 랜덤 10개 지역 테스트 시작', 'info');
            log('-' * 30);
            
            const allRegions = getAllRegionsFlat();
            const cities = allRegions.filter(r => r.type === 'city');
            const testRegions = cities.sort(() => Math.random() - 0.5).slice(0, 10);
            
            let successCount = 0;
            
            testRegions.forEach((region, index) => {
                log(`\n${index + 1}. ${region.fullName || region.name} (${region.code}) 테스트`, 'info');
                
                const supportInfo = checkRegionSupport(region.code);
                
                if (supportInfo.isSupported) {
                    log(`   ✅ 지원됨 | 정확도: ${supportInfo.exact ? '정확' : '유사'}`, 'success');
                    log(`   🎯 매핑: ${region.name} → ${supportInfo.regionName}`, 'info');
                    successCount++;
                } else {
                    log(`   ❌ 미지원`, 'error');
                    log(`   💡 추천: ${supportInfo.suggestions.map(s => s.name).join(', ')}`, 'warning');
                }
            });
            
            const successRate = (successCount / testRegions.length * 100).toFixed(1);
            log(`\n📈 결과: ${successCount}/${testRegions.length} 성공 (${successRate}%)`, 
                successRate >= 80 ? 'success' : 'warning');
        };

        // 특수 케이스 테스트
        window.runSpecialCases = function() {
            log('🔍 특수 케이스 테스트 시작', 'info');
            log('-' * 30);
            
            const specialCases = [
                { input: '제주', expected: '제주' },
                { input: 'jeju', expected: null }, // 영문 코드는 지원하지 않음
                { input: '태백', expected: '태백시' },
                { input: '서울', expected: '서울' },
                { input: '강남', expected: '강남구' },
                { input: '존재하지않는지역', expected: null }
            ];
            
            specialCases.forEach(testCase => {
                const result = checkRegionSupport(testCase.input);
                const success = testCase.expected === null ? 
                    !result.isSupported : 
                    result.isSupported && result.regionName.includes(testCase.expected);
                
                log(`   ${testCase.input} → ${result.regionName || '미지원'} ${success ? '✅' : '❌'}`, 
                    success ? 'success' : 'error');
                
                if (result.suggestions && result.suggestions.length > 0) {
                    log(`      추천: ${result.suggestions.map(s => s.name).join(', ')}`, 'info');
                }
            });
        };

        // 전체 테스트 실행
        window.runAllTests = function() {
            clearLog();
            log('🎯 전체 테스트 실행 시작', 'info');
            log('=' * 60);
            
            runBasicTests();
            log('');
            runRandomTests();
            log('');
            runSpecialCases();
            log('');
            log('🎉 모든 테스트 완료!', 'success');
        };

        // 페이지 로드 시 통계 업데이트
        updateStats();
        log('✨ 전국 244개 지역 커버리지 테스트 시스템 준비 완료', 'success');
        log('위의 버튼을 클릭하여 다양한 테스트를 실행해보세요.', 'info');
    </script>
</body>
</html>